<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> 
<html lang="fr"> 
    <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
    <meta name="viewport" content="width=device-width" />
    <title>Jardin Filtre Flux</title> 
    <link rel="stylesheet" href="demo.css" type="text/css" media="screen"> 
    <link rel="stylesheet" href="demo-print.css" type="text/css" media="print"> 
	<script src="jquery-1.4.4.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="raphael-min.js" type="text/javascript" charset="utf-8"></script> 
    <script src="jardin.js" type="text/javascript" charset="utf-8"></script> 
    <script src="graine.js" type="text/javascript" charset="utf-8"></script> 
    <script src="nuage.js" type="text/javascript" charset="utf-8"></script> 
    <script src="bulle.js" type="text/javascript" charset="utf-8"></script>
    <script src="popup.js"></script> 
    <script src="rhizome.js"></script> 
    <script type="text/javascript" charset="utf-8"> 
	window.onload = function () {
		if(svgWarning())demandeCompte();
	};
// Display a warning for browsers without SVG
	var svgWarningHtml = '<div id="svgWarning" style="z-index: 1; width: 300px; padding: 8px 8px 8px 8px; position: fixed; top: 200px; left: 50%; margin-left: -150px; background: #ffd; border: solid 4px #b00; font-size: 14pt;"><div id="warnclose" style="position: absolute; right: 12px; color: white; font-weight: bold; cursor: default;" >X</div> <div id="warntitle" style="font-weight: bold; background: #b00; color: white; text-align: center;">WARNING</div> Votre navigateur ne supporte pas le SVG qui est utilisé par ce site. Veuillez utiliser <A href="http://www.w3.org/Graphics/SVG/WG/wiki/Implementations">un navigateur compatible</a>.</div></div>';
	
	function svgWarning() {
	    // SVG test taken from Modernizr 2.0
	    if (!!document.createElementNS &&
	        !!document.createElementNS('http://www.w3.org/2000/svg', 'svg').createSVGRect)
	        return true;
	    // No SVG, do something about it.
	    $("jardin").html(svgWarningHtml);
        return false;
	}

	function demandeCompte(){
		var saisie = prompt("Saisissez le nom du compte delicious ou annulez", "");
		if (saisie!=null) {
        	cultive(saisie);	
		}else{
        	cultive("luckysemiosis");	
		}			
	}
	function cultive(compte){
		//création de la scène
		var R = Raphael("jardin", 2560, 1280);
		//création du jardin
		var J = new jardin(R, 0, 0, 2560, 1280, compte);
		J.draw();
		//évènement pour planter des graines
		J.compost.node.onclick = function (event) {
			J.planteGraine(event.pageX,event.pageY,"");
		};
		//création des nuages a partir d'un js en local
		//J.data = data;
		//J.setNuage();		
		//création des nuages a partir des tags d'un compte delicious
		//var type = "deliciousTagsUser";
		//var url = "http://feeds.delicious.com/v2/json/tags/"+J.exis;
		//création des nuages a partir du bookmark d'un compte delicious
		var type = "deliciousBookUser";
		var url = "http://feeds.delicious.com/v2/json/"+J.exis;
		$.ajax({
			type: "GET", 
			dataType: "jsonp", 
			url: url,
			/*
			complete: function (xhr, ajaxOptions, thrownError) { 
				if(xhr.status == 404) { 
					alert("le compte n'a pas été trouvé");
			      	demandeCompte();
				}else{ 
					alert("le compte n'a pas été trouvé");
			      	demandeCompte();
				} 
			},
			*/  
			success: function(data){
				J.data = data;
				J.setNuage(type);
			}
		});
				
	}
    </script> 
    </head> 
    <body> 
		<div id="jardin"></div>
    </body> 
</html>